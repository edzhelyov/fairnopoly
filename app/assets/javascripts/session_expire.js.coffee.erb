startTime = new Date().getTime()
expireTime = startTime + (60 * 60 * 1000)

checkIfExpired = ->
  if new Date().getTime() >= expireTime
    checkIfExpiredOnServer (expired) ->
      if expired
        window.clearInterval interval
        displayWarning()

checkIfExpiredOnServer = (callback) ->
  $.get '/toolbox/session.json', (result) ->
    callback result.expired

displayWarning = ->
  $.colorbox({
    transition: "none",
    width: "75%",
    opacity: 0.4,
    html: "<p style='text-align:center;margin:10px 0 0 0'><%= I18n.t 'common.session_expiring_notice' %></p>"
  });

interval = window.setInterval checkIfExpired, 600000 # every 10 min
